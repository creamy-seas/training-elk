version: '3.4'
services:
  elasticsearch:
    build: elastic
    environment:
      - "ES_JAVA_OPTS=-Xms4096m -Xmx32768m"
    ulimits:
      nproc: 65535
      nofile:
        soft: 65535
        hard: 65535
      memlock:
        soft: -1
        hard: -1
    restart: always
    # expose:
      # - 9200
    # ports:
    #   - 9200:9200
    volumes:
      - /data/elasticsearch:/usr/share/elasticsearch/data
  logstash:
    build: logstash
    depends_on:
      - elasticsearch
    ports:
      - 8080:8080
    environment:
      - "LS_JAVA_OPTS=-Xms4096m -Xmx32768m"
    restart: always
  kibana:
    build: kibana
    depends_on:
      - elasticsearch
    restart: always
  frontend:
    build: frontend
    ports:
      - 80:80
    depends_on:
      - kibana
      - elasticsearch
    # volumes:
    #   - /data/certbot/conf:/etc/letsencrypt
    #   - /data/certbot/www:/var/www/certbot
    restart: always

  # certbot:
  #   image: certbot/certbot
  #   volumes:
  #     - /data/certbot/conf:/etc/letsencrypt
  #     - /data/certbot/www:/var/www/certbot
